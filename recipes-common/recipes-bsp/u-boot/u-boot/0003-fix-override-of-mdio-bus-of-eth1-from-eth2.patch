 drivers/net/ravb.c        | 39 ++++++++++++++++++++++++++++++++++++++-
 1 files changed, 39 insertions(+), 1 deletion(-)

diff --git a/drivers/net/ravb.c b/drivers/net/ravb.c
index 5a5a242d51..a73b63be38 100644
--- a/drivers/net/ravb.c
+++ b/drivers/net/ravb.c
@@ -541,6 +541,7 @@ static int ravb_probe(struct udevice *dev)
 	struct mii_dev *mdiodev;
 	void __iomem *iobase;
 	int ret;
+	int i;
 
 	iobase = map_physmem(pdata->iobase, 0x1000, MAP_NOCACHE);
 	eth->iobase = iobase;
@@ -568,7 +569,16 @@ static int ravb_probe(struct udevice *dev)
 
 	mdiodev->read = bb_miiphy_read;
 	mdiodev->write = bb_miiphy_write;
+#ifdef CONFIG_BITBANGMII_MULTI
+	for (i = 0; i < bb_miiphy_buses_num; i++) {
+		if(NULL == bb_miiphy_buses[i].priv) {
+			bb_miiphy_buses[i].priv = eth;
+			break;
+		}
+	}
+#else
 	bb_miiphy_buses[0].priv = eth;
+#endif
 	snprintf(mdiodev->name, sizeof(mdiodev->name), dev->name);
 
 	ret = mdio_register(mdiodev);
@@ -682,7 +692,21 @@ int ravb_bb_delay(struct bb_miiphy_bus *bus)
 
 struct bb_miiphy_bus bb_miiphy_buses[] = {
 	{
-		.name		= "ravb",
+		.name		= "",
+		.init		= ravb_bb_init,
+		.mdio_active	= ravb_bb_mdio_active,
+		.mdio_tristate	= ravb_bb_mdio_tristate,
+		.set_mdio	= ravb_bb_set_mdio,
+		.get_mdio	= ravb_bb_get_mdio,
+		.set_mdc	= ravb_bb_set_mdc,
+		.delay		= ravb_bb_delay,
+#ifdef CONFIG_BITBANGMII_MULTI
+		.priv		= NULL,
+#endif
+	},
+#ifdef CONFIG_BITBANGMII_MULTI
+	{
+		.name		= "",
 		.init		= ravb_bb_init,
 		.mdio_active	= ravb_bb_mdio_active,
 		.mdio_tristate	= ravb_bb_mdio_tristate,
@@ -690,7 +714,9 @@ struct bb_miiphy_bus bb_miiphy_buses[] = {
 		.get_mdio	= ravb_bb_get_mdio,
 		.set_mdc	= ravb_bb_set_mdc,
 		.delay		= ravb_bb_delay,
+		.priv		= NULL,
 	},
+#endif
 };
 int bb_miiphy_buses_num = ARRAY_SIZE(bb_miiphy_buses);
 
@@ -709,6 +735,7 @@ int ravb_of_to_plat(struct udevice *dev)
 	const char *phy_mode;
 	const fdt32_t *cell;
 	int ret = 0;
+	int i;
 
 	pdata->iobase = dev_read_addr(dev);
 	pdata->phy_interface = -1;
@@ -726,7 +753,17 @@ int ravb_of_to_plat(struct udevice *dev)
 	if (cell)
 		pdata->max_speed = fdt32_to_cpu(*cell);
 
+#ifdef CONFIG_BITBANGMII_MULTI
+	for (i = 0; i < bb_miiphy_buses_num; i++) {
+		if(!strlen(bb_miiphy_buses[i].name)) {
+			sprintf(bb_miiphy_buses[i].name, dev->name);
+			return ret;
+		}
+	}
+	return -EPERM;
+#else
 	sprintf(bb_miiphy_buses[0].name, dev->name);
+#endif
 
 	return ret;
 }
